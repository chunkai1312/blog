{"title":"MongoDB 備份與還原","slug":"mongodump-and-mongorestore","date":"2020-09-28T08:03:36.000Z","updated":"2021-09-05T09:21:23.416Z","comments":true,"path":"api/articles/mongodump-and-mongorestore.json","excerpt":"以往習慣用 db.copyDatabase()，來備份 MongoDB 資料庫，不過從 MongoDB 4.2 版開始，官方已經移除 copydb 命令，包含 db.copyDatabase() 在內，僅支援 MongoDB 4.0 或更早的版本。MongoDB 4.2+ 版本則必須使用 mongodump 及 mongorestore 來 Copy/Clone 資料庫。 [Figure] ","covers":["/2020/09/28/mongodump-and-mongorestore/cover.jpg"],"content":"<blockquote>\n<p>以往習慣用 <code>db.copyDatabase()</code>，來備份 MongoDB 資料庫，不過從 MongoDB 4.2 版開始，官方已經移除 <strong>copydb</strong> 命令，包含 <code>db.copyDatabase()</code> 在內，僅支援 MongoDB 4.0 或更早的版本。MongoDB 4.2+ 版本則必須使用 <code>mongodump</code> 及 <code>mongorestore</code> 來 Copy/Clone 資料庫。</p>\n</blockquote>\n<p><img src=\"/2020/09/28/mongodump-and-mongorestore/cover.jpg\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"備份資料庫\"><a href=\"#備份資料庫\" class=\"headerlink\" title=\"備份資料庫\"></a>備份資料庫</h2><p>假設在本地端有一個 <code>test</code> 資料庫運行在預設 27017 port，可以使用 <a href=\"https://docs.mongodb.com/database-tools/mongodump/#bin.mongodump\">mongodump</a> 指令打包備份：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">$ mongodump <span class=\"hljs-attribute\">--archive</span>=<span class=\"hljs-string\">&quot;mongodump-test-db&quot;</span> <span class=\"hljs-attribute\">--db</span>=test<br></code></pre></td></tr></table></figure>\n\n<p>以上將備份資料庫打包成 <code>mongodump-test-db</code> 檔案。</p>\n<h2 id=\"還原資料庫\"><a href=\"#還原資料庫\" class=\"headerlink\" title=\"還原資料庫\"></a>還原資料庫</h2><p>假設要將打包好的 <code>test</code> 資料庫還原到名為 <code>examples</code> 資料庫，可以使用 <a href=\"https://docs.mongodb.com/database-tools/mongorestore/#bin.mongorestore\">mongorestore</a> 進行資料還原：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">$ mongorestore <span class=\"hljs-attribute\">--archive</span>=<span class=\"hljs-string\">&quot;mongodump-test-db&quot;</span> <span class=\"hljs-attribute\">--nsFrom</span>=<span class=\"hljs-string\">&#x27;test.*&#x27;</span> <span class=\"hljs-attribute\">--nsTo</span>=<span class=\"hljs-string\">&#x27;examples.*&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>可以根據環境需求加入其他選項，例如指定 uri 或 host、username、password 進行身份驗證。使用 <code>mongodump --help</code> 及 <code>mongorestore --help</code> 查看其他可用選項。</p>\n<h2 id=\"參考資料\"><a href=\"#參考資料\" class=\"headerlink\" title=\"參考資料\"></a>參考資料</h2><p><a href=\"https://docs.mongodb.com/database-tools/mongodump/#mongodump-example-copy-clone-database\">Copy/Clone a Database</a></p>\n","more":"<h2 id=\"備份資料庫\"><a href=\"#備份資料庫\" class=\"headerlink\" title=\"備份資料庫\"></a>備份資料庫</h2><p>假設在本地端有一個 <code>test</code> 資料庫運行在預設 27017 port，可以使用 <a href=\"https://docs.mongodb.com/database-tools/mongodump/#bin.mongodump\">mongodump</a> 指令打包備份：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">$ mongodump <span class=\"hljs-attribute\">--archive</span>=<span class=\"hljs-string\">&quot;mongodump-test-db&quot;</span> <span class=\"hljs-attribute\">--db</span>=test<br></code></pre></td></tr></table></figure>\n\n<p>以上將備份資料庫打包成 <code>mongodump-test-db</code> 檔案。</p>\n<h2 id=\"還原資料庫\"><a href=\"#還原資料庫\" class=\"headerlink\" title=\"還原資料庫\"></a>還原資料庫</h2><p>假設要將打包好的 <code>test</code> 資料庫還原到名為 <code>examples</code> 資料庫，可以使用 <a href=\"https://docs.mongodb.com/database-tools/mongorestore/#bin.mongorestore\">mongorestore</a> 進行資料還原：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">$ mongorestore <span class=\"hljs-attribute\">--archive</span>=<span class=\"hljs-string\">&quot;mongodump-test-db&quot;</span> <span class=\"hljs-attribute\">--nsFrom</span>=<span class=\"hljs-string\">&#x27;test.*&#x27;</span> <span class=\"hljs-attribute\">--nsTo</span>=<span class=\"hljs-string\">&#x27;examples.*&#x27;</span><br></code></pre></td></tr></table></figure>\n\n<p>可以根據環境需求加入其他選項，例如指定 uri 或 host、username、password 進行身份驗證。使用 <code>mongodump --help</code> 及 <code>mongorestore --help</code> 查看其他可用選項。</p>\n<h2 id=\"參考資料\"><a href=\"#參考資料\" class=\"headerlink\" title=\"參考資料\"></a>參考資料</h2><p><a href=\"https://docs.mongodb.com/database-tools/mongodump/#mongodump-example-copy-clone-database\">Copy/Clone a Database</a></p>","categories":[{"name":"工具應用","path":"api/categories/工具應用.json"}],"tags":[{"name":"MongoDB","path":"api/tags/MongoDB.json"},{"name":"mongodump","path":"api/tags/mongodump.json"},{"name":"mongorestore","path":"api/tags/mongorestore.json"}]}